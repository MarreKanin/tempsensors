# Information sensor read

Data is generated by [rtl_433](https://github.com/merbanan/rtl_433) and started by a python script initialized by /etc/rc.local. This makes the script startup on boot and will go as long as the device is powered on.

```
/usr/bin/python /home/pi/temp/getTemp.py
```

getTemp.py is a program that just runs the rtl_433 module, but can be run from a bashscript aswell. Contents of getTemp.py:

```python
#!/usr/bin/python
import os
import json
program = os.popen('/home/pi/rtl_433/build/src/rtl_433 -F json > /home/pi/temp/data/temp.txt')
```

This stores the datafindings to temp.txt constantly as it finds data. The data is now going to be transformed and sent to a external API to get stored in a database. I use a cronjob to initialize the data read and the data sender.

```
* * * * * /usr/bin/python /home/pi/temp/sendTemp.py &> /tmp/errors
```

```python
import json
import requests
def main():
        data = []
        with open('/home/pi/temp/data/temp.txt', 'r') as file:
                try:
                        for line in file:
                                line = line.replace('\n', '')
                                if len(line) < 40:
                                        print("file is empty")
                                        raise SystemExit
                                if len(line) > 40:
                                        data.append(line)
                except:
                        raise SystemExit
        try:
                for line in data:
                        print(line)
                        templine = json.loads(line)
                        battery = templine['battery']
                        print(battery)
                        humidity = templine['humidity']
                        temprature = templine['temperature_C']
                        time = templine['time']
                        model = templine['model']
                        id = templine['id']
                        channel = templine['channel']
                        try:
                                senddata(battery, humidity, temprature, time, model, id, channel)
                        except Exception as e:
                                print(e)
        except Exception as e:
                print(e)
                raise SystemExit
        with open('/home/pi/temp/data/temp.txt', 'w+') as file:
                # Delete data in temp.txt
                pass
def senddata(battery, humidity, temprature, time, model, id, channel):
        url = 'https://external-api.url'
        data = {"time": time, "model": model, "housecode": id, "channel": channel, "battery": battery, "temp": temprature, "humidity": humidity}
        thesending = requests.post(url, data=data, verify=False)
if __name__ == "__main__":
        main()
```
